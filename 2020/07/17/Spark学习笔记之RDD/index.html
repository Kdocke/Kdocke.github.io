<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Kdocke">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->

<meta name="keywords" content="大数据,Spark,RDD" />


<meta name="description" content="Spark RDD1. 简述RDD 是一个基本的抽象，操作RDD就像操作一个本地集合一样，降低了编程的复杂度。
RDD 里面记录的是描述信息（从哪里读数据、以后对数据如何计算）、RDD 的方法分..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    Spark 学习笔记之 RDD |
    
    Kdocke
</title>

<link rel="alternate" href="/atom.xml" title="Kdocke" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">

    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<meta name="generator" content="Hexo 4.2.1"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    http://snippet.shenliyang.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='Kdocke'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">
                        Kdocke</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                主页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/教程/"><i class="fa "></i>
                                教程</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/记录/"><i class="fa "></i>
                                记录</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/散文/"><i class="fa "></i>
                                散文</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/分享/"><i class="fa "></i>
                                分享</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/about/"><i class="fa "></i>
                                关于</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Spark 学习笔记之 RDD">
            
            Spark 学习笔记之 RDD
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/%E8%AE%B0%E5%BD%95/">记录</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-link" href="/tags/RDD/" rel="tag">RDD</a> <a class="tag-link" href="/tags/Spark/" rel="tag">Spark</a> <a class="tag-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2020/07/17</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="Spark-RDD"><a href="#Spark-RDD" class="headerlink" title="Spark RDD"></a>Spark RDD</h1><h2 id="1-简述"><a href="#1-简述" class="headerlink" title="1. 简述"></a>1. 简述</h2><p>RDD 是一个基本的抽象，操作RDD就像操作一个本地集合一样，降低了编程的复杂度。</p>
<p>RDD 里面记录的是描述信息（从哪里读数据、以后对数据如何计算）、RDD 的方法分为两类 Transformation、Action（生成 Task，并发送到 Excutor 中执行）</p>
<p>RDD的特点：</p>
<ul>
<li>1、一系列分区</li>
<li>2、每一个输入切片会有一个函数作用在上面</li>
<li>3、RDD 和 RDD 之间存在依赖关系（子 RDD 是 父 RDD 调用什么方法，传入哪些函数得到的）</li>
<li>4、（可选）RDD 中如果存储的是 KV，shuffle 时会有一个分区器，默认是 hash partitioner</li>
<li>5、（可选）如果是读取 HDFS 中的数据，那么会有一个最优位置</li>
</ul>
<p>一个分区对应一个 Task（在同一个 Stage）, 一个分区对应的 Task 只能在一台机器里面（Executor），一台机器上可以有多个分区对应的 Task。</p>
<h2 id="2-RDD-常用算子"><a href="#2-RDD-常用算子" class="headerlink" title="2. RDD 常用算子"></a>2. RDD 常用算子</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># scala 转 <span class="type">RDD</span> 并行计算</span><br><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>))</span><br><span class="line"><span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">List</span>(<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>)).map(_*<span class="number">2</span>).sortBy(x=&gt;x,<span class="literal">true</span>)</span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd2.filter(_&gt;<span class="number">10</span>)</span><br><span class="line"><span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">List</span>(<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>)).map(_*<span class="number">2</span>).sortBy(x=&gt;x+<span class="string">""</span>,<span class="literal">true</span>)</span><br><span class="line"><span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">List</span>(<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>)).map(_*<span class="number">2</span>).sortBy(x=&gt;x.toString,<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd4 = sc.parallelize(<span class="type">Array</span>(<span class="string">"a b c"</span>, <span class="string">"d e f"</span>, <span class="string">"h i j"</span>))</span><br><span class="line">rdd4.flatMap(_.split(' ')).collect</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd5 = sc.parallelize(<span class="type">List</span>(<span class="type">List</span>(<span class="string">"a b c"</span>, <span class="string">"a b b"</span>),<span class="type">List</span>(<span class="string">"e f g"</span>, <span class="string">"a f g"</span>), <span class="type">List</span>(<span class="string">"h i j"</span>, <span class="string">"a a b"</span>)))</span><br><span class="line">rdd5.flatMap(_.flatMap(_.split(<span class="string">" "</span>))).collect</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># union求并集，注意类型要一致</span><br><span class="line"><span class="keyword">val</span> rdd6 = sc.parallelize(<span class="type">List</span>(<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">7</span>))</span><br><span class="line"><span class="keyword">val</span> rdd7 = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="keyword">val</span> rdd8 = rdd6.union(rdd7)</span><br><span class="line">rdd8.distinct.sortBy(x=&gt;x).collect</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># intersection求交集</span><br><span class="line"><span class="keyword">val</span> rdd9 = rdd6.intersection(rdd7)</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>((<span class="string">"tom"</span>, <span class="number">1</span>), (<span class="string">"jerry"</span>, <span class="number">2</span>), (<span class="string">"kitty"</span>, <span class="number">3</span>)))</span><br><span class="line"><span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">List</span>((<span class="string">"jerry"</span>, <span class="number">9</span>), (<span class="string">"tom"</span>, <span class="number">8</span>), (<span class="string">"shuke"</span>, <span class="number">7</span>), (<span class="string">"tom"</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">#join(连接)</span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd1.join(rdd2)</span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd1.leftOuterJoin(rdd2)</span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd1.rightOuterJoin(rdd2)</span><br><span class="line"></span><br><span class="line"># groupByKey（不会局部聚合）</span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd1 union rdd2</span><br><span class="line">rdd3.groupByKey</span><br><span class="line"><span class="comment">//(tom,CompactBuffer(1, 8, 2))</span></span><br><span class="line">rdd3.groupByKey.map(x=&gt;(x._1,x._2.sum))</span><br><span class="line">groupByKey.mapValues(_.sum).collect</span><br><span class="line"><span class="type">Array</span>((tom,<span class="type">CompactBuffer</span>(<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>)), (jerry,<span class="type">CompactBuffer</span>(<span class="number">9</span>, <span class="number">2</span>)), (shuke,<span class="type">CompactBuffer</span>(<span class="number">7</span>)), (kitty,<span class="type">CompactBuffer</span>(<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"># <span class="type">WordCount</span></span><br><span class="line">sc.textFile(<span class="string">"/root/words.txt"</span>).flatMap(x=&gt;x.split(<span class="string">" "</span>)).map((_,<span class="number">1</span>)).reduceByKey(_+_).sortBy(_._2,<span class="literal">false</span>).collect</span><br><span class="line">sc.textFile(<span class="string">"/root/words.txt"</span>).flatMap(x=&gt;x.split(<span class="string">" "</span>)).map((_,<span class="number">1</span>)).groupByKey.map(t=&gt;(t._1, t._2.sum)).collect</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># cogroup</span><br><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>((<span class="string">"tom"</span>, <span class="number">1</span>), (<span class="string">"tom"</span>, <span class="number">2</span>), (<span class="string">"jerry"</span>, <span class="number">3</span>), (<span class="string">"kitty"</span>, <span class="number">2</span>)))</span><br><span class="line"><span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">List</span>((<span class="string">"jerry"</span>, <span class="number">2</span>), (<span class="string">"tom"</span>, <span class="number">1</span>), (<span class="string">"shuke"</span>, <span class="number">2</span>)))</span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd1.cogroup(rdd2)</span><br><span class="line"><span class="keyword">val</span> rdd4 = rdd3.map(t=&gt;(t._1, t._2._1.sum + t._2._2.sum))</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cartesian笛卡尔积</span><br><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="string">"tom"</span>, <span class="string">"jerry"</span>))</span><br><span class="line"><span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">List</span>(<span class="string">"tom"</span>, <span class="string">"kitty"</span>, <span class="string">"shuke"</span>))</span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd1.cartesian(rdd2)</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># spark action</span><br><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"># collect</span><br><span class="line">rdd1.collect</span><br><span class="line"></span><br><span class="line"># reduce</span><br><span class="line"><span class="keyword">val</span> r = rdd1.reduce(_+_)</span><br><span class="line"></span><br><span class="line"># reduceByKey（局部聚合再全局聚合）</span><br><span class="line"></span><br><span class="line"># count</span><br><span class="line">rdd1.count</span><br><span class="line"></span><br><span class="line"># top</span><br><span class="line">rdd1.top(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"># take</span><br><span class="line">rdd1.take(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"># first(similer to take(<span class="number">1</span>))</span><br><span class="line">rdd1.first</span><br><span class="line"></span><br><span class="line"># takeOrdered</span><br><span class="line">rdd1.takeOrdered(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h2 id="3-高级算子"><a href="#3-高级算子" class="headerlink" title="3. 高级算子"></a>3. 高级算子</h2><p><strong>mapPartitionsWithIndex:</strong> 一次拿出一个分区（分区在并没有数据，而是记录要读取哪些数据，真正生成的 Task 才会读取多条数据），并且可以将分区的编号取出来</p>
<p><strong>功能：</strong>取分区中对应的数据时，还可以将分区的编号取出来，这样就可以知道数据是属于哪个分区的（哪个分区对应的Task的数据）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">val rdd = sc.parallelize(List(1,2,3,4,5,6,7,8,9), 2)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自定义函数(将对应分区中的数据取出来，并且带上分区编号)</span></span><br><span class="line">val func = (index: Int, it: Iterator[Int]) =&gt; &#123;</span><br><span class="line">	it.map(e =&gt; s"part: $index, ele: $e")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val rdd2 = rdd.mapPartitionsWithIndex(func)</span><br><span class="line">rdd2.collect</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果:</span></span><br><span class="line">res0: Array[String] = Array(part: 0, ele: 1, part: 0, ele: 2, part: 0, ele: 3, part: 0, ele: 4, part: 1, ele: 5, part: 1, ele: 6, part: 1, ele: 7, part: 1, ele: 8, part: 1, ele: 9)</span><br></pre></td></tr></table></figure>

<p><strong>aggregate:</strong> 聚合（局部聚合再全局聚合）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">val rdd = sc.parallelize(List(1,2,3,4,5,6,7,8,9), 2)</span><br><span class="line">val rdd2 = sc.parallelize(List("a","b","c","d","e","f"), 2)</span><br><span class="line">val rdd3 = sc.parallelize(List("12","23","345","4567"), 2)</span><br><span class="line">val rdd4 = sc.parallelize(List("12","23","345",""), 2)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1</span></span><br><span class="line">rdd.aggregate(0)(_+_, _+_)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2</span></span><br><span class="line">rdd.aggregate(0)(math.max(_,_), _+_)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3</span></span><br><span class="line">rdd2.aggregate("")(_+_, _+_)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4</span></span><br><span class="line">rdd3.aggregate("")((x, y) =&gt; math.max(x.length, y.length).toString, (x,y) =&gt; x+y)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5</span></span><br><span class="line">rdd4.aggregate("")((x,y) =&gt; math.min(x.length, y.length).toString, (x,y) =&gt; x+y)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果:</span></span><br><span class="line">1:	res1: Int = 45</span><br><span class="line">2:	res2: Int = 13</span><br><span class="line">3:	res3: String = abcdef	or	res4: String = defabc</span><br><span class="line">4:	res5: String = 24	or	res13: String = 42</span><br><span class="line">5:	res14: String = 01	or	res16: String = 10</span><br></pre></td></tr></table></figure>

<p><strong>aggregateByKey:</strong> 分组聚合</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val pairRDD = sc.parallelize(List( ("cat",2), ("cat", 5), ("mouse", 4),("cat", 12), ("dog", 12), ("mouse", 2)), 2)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1</span></span><br><span class="line">pairRDD.aggregateByKey(0)(_+_, _+_).collect</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果:</span></span><br><span class="line">1:	res17: Array[(String, Int)] = Array((dog,12), (cat,19), (mouse,6))</span><br></pre></td></tr></table></figure>

<p><strong>collectAsMap:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val rdd = sc.parallelize(List(("a", 1), ("b", 2)))</span><br><span class="line"></span><br><span class="line">rdd.collectAsMap</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果:</span></span><br><span class="line">res19: scala.collection.Map[String,Int] = Map(b -&gt; 2, a -&gt; 1)</span><br></pre></td></tr></table></figure>

<p><strong>countByKey:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">val rdd1 = sc.parallelize(List(("a", 1), ("b", 2), ("b", 2), ("c", 2), ("c", 1)))</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1</span></span><br><span class="line">rdd1.countByKey</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2</span></span><br><span class="line">rdd1.countByValue</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果：</span></span><br><span class="line">1：	res0: scala.collection.Map[String,Long] = Map(a -&gt; 1, b -&gt; 2, c -&gt; 2)</span><br><span class="line">2：	res1: scala.collection.Map[(String, Int),Long] = Map((a,1) -&gt; 1, (b,2) -&gt; 2, (c,2) -&gt; 1, (c,1) -&gt; 1)</span><br></pre></td></tr></table></figure>

<p><strong>filterByRange：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val rdd1 = sc.parallelize(List(("e", 5), ("c", 3), ("d", 4), ("c", 2), ("a", 1)))</span><br><span class="line"></span><br><span class="line">rdd1.filterByRange("b", "d").collect</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果：</span></span><br><span class="line">res2: Array[(String, Int)] = Array((c,3), (d,4), (c,2))</span><br></pre></td></tr></table></figure>

<p><strong>flatMapValues：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val rdd3 = sc.parallelize(List(("a", "1 2"), ("b", "3 4")))</span><br><span class="line"></span><br><span class="line">rdd3.flatMapValues(_.split(" ")).collect</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果：</span></span><br><span class="line">res5: Array[(String, String)] = Array((a,1), (a,2), (b,3), (b,4))</span><br></pre></td></tr></table></figure>

<p><strong>foldByKey:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">val rdd1 = sc.parallelize(List("dog", "wolf", "cat", "bear"), 2)</span><br><span class="line"></span><br><span class="line">val rdd2 = rdd1.map(x =&gt; (x.length, x))</span><br><span class="line">val rdd3 = rdd2.foldByKey("")(_+_)</span><br><span class="line">rdd3.collect</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果：</span></span><br><span class="line">res8: Array[(Int, String)] = Array((4,bearwolf), (3,dogcat))</span><br></pre></td></tr></table></figure>

<p><strong>foreach</strong> 和 <strong>foreachPartition</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val rdd = sc.parallelize(List(1,2,3,4,5,6,7,8), 2)</span><br><span class="line"></span><br><span class="line">rdd.foreach(x =&gt; println(x*100))</span><br><span class="line">rdd.foreachPartition(it =&gt; it.foreach(x =&gt; println(x*10000)))</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<table>
<thead>
<tr>
<th align="left">Transformation</th>
<th>Action</th>
</tr>
</thead>
<tbody><tr>
<td align="left">aggregateByKey</td>
<td>collect</td>
</tr>
<tr>
<td align="left">reduceByKey</td>
<td>aggregate</td>
</tr>
<tr>
<td align="left">filter</td>
<td>saveAsTextFile</td>
</tr>
<tr>
<td align="left">flatMap</td>
<td>foreach</td>
</tr>
<tr>
<td align="left">map</td>
<td>foreachPartition</td>
</tr>
<tr>
<td align="left">mapPartition</td>
<td></td>
</tr>
<tr>
<td align="left">mapPartitionWithIndex</td>
<td></td>
</tr>
</tbody></table>
<h2 id="4-WordCount-的执行流程"><a href="#4-WordCount-的执行流程" class="headerlink" title="4. WordCount 的执行流程"></a>4. WordCount 的执行流程</h2><p>6 个 RDD</p>
<p>2 个 Stage</p>
<p>2 类 Task</p>
<p>4 个 Task（2个分区）</p>
<h2 id="5-Cache"><a href="#5-Cache" class="headerlink" title="5. Cache"></a>5. Cache</h2><p>什么时候进行 cache:</p>
<ul>
<li>要求计算速度快</li>
<li>集群的资源足够大</li>
<li>重要：cache 的数据会多次的触发 Action</li>
<li>先进行过滤，然后将缩小范围的数据再 cache 到内存</li>
</ul>
<p>cache 实际调用的是 persist( ) 方法</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="type">NONE</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">DISK_ONLY</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">DISK_ONLY_2</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_ONLY</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_ONLY_2</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_ONLY_SER</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_ONLY_SER_2</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_AND_DISK</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_AND_DISK_2</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_AND_DISK_SER</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MEMORY_AND_DISK_SER_2</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">OFF_HEAP</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="type">MEMORY_AND_DISK</span> = <span class="keyword">new</span> <span class="type">StorageLevel</span>(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// 第一个参数，放到磁盘</span></span><br><span class="line"><span class="comment">// 第二个参数，放到内存</span></span><br><span class="line"><span class="comment">// 第三个参数，使不使用 OFF_HEAP</span></span><br><span class="line"><span class="comment">// 第四个参数，内存中的数据，以java对象的方式保存</span></span><br><span class="line"></span><br><span class="line"><span class="type">OFF_HEAP</span>:堆外内存 （<span class="type">Tachyon</span>，分布式内存存储系统）</span><br><span class="line"><span class="type">Alluxio</span> - <span class="type">Open</span> <span class="type">Source</span> <span class="type">Memory</span> <span class="type">Speed</span> <span class="type">Virtual</span> <span class="type">Distributed</span> <span class="type">Storage</span></span><br></pre></td></tr></table></figure>

<p><strong>使用：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将数据缓存至内存</span></span><br><span class="line">val cached: RDD[((String, String), Int)] = reduced.cache()</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用缓存的数据进行计算</span></span><br><span class="line">val filtered: RDD[((String, String), Int)] = cached.filter(_._1._1 == sb)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 释放缓存</span></span><br><span class="line">cached.unpersist(true)</span><br></pre></td></tr></table></figure>

<h2 id="6-CheckPoint"><a href="#6-CheckPoint" class="headerlink" title="6. CheckPoint"></a>6. CheckPoint</h2><p>什么时候做 checkpoint:</p>
<ul>
<li>迭代计算，要求保证数据安全</li>
<li>对速度要求不高（跟cache到内存进行对比）</li>
<li>将中间结果保存到hdfs</li>
</ul>
<p>设置checkpoint目录（分布式文件系统的目录hdfs目录）<br>经过复杂进行，得到中间结果<br>将中间结果checkpoint到指定的hdfs目录<br>后续的计算，就可以使用前面ck的数据了</p>
<p><strong>使用：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置还原点目录（分布式文件系统）</span></span><br><span class="line">sc.setCheckpointDir("hdfs://NameNode:9000/test")</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 读数据</span></span><br><span class="line">val lines = sc.textFile("hdfs://NameNode/data")</span><br><span class="line">val filtered = lines.filter(_.contains("javaee"))</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置 checkpoint 的数据，此时不会写数据，只会标记</span></span><br><span class="line">filtered.checkpoint</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时会 checkpoint 数据</span></span><br><span class="line">filter.count</span><br></pre></td></tr></table></figure>


    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Kdocke</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    
    <a href="/2020/07/16/SlideToShutDown%E4%B8%8B%E6%BB%91%E5%85%B3%E6%9C%BA%E4%BB%BB%E5%8A%A1%E6%A0%8F%E8%AE%BE%E7%BD%AE/" class="next-post btn btn-default" title='SlideToShutDown 下滑关机任务栏设置'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            SlideToShutDown 下滑关机任务栏设置</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>

<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'aKPOlV9P3OhFhLHTQasU7dNy-gzGzoHsz',
    appKey: 'gIhefzuBgFzwceTzzGrlizob',
    placeholder: '说点什么吧',
    notify: false,
    verify: false,
    avatar: 'wavatar',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'zh-CN'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spark-RDD"><span class="toc-text">Spark RDD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-简述"><span class="toc-text">1. 简述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-RDD-常用算子"><span class="toc-text">2. RDD 常用算子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-高级算子"><span class="toc-text">3. 高级算子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-WordCount-的执行流程"><span class="toc-text">4. WordCount 的执行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Cache"><span class="toc-text">5. Cache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-CheckPoint"><span class="toc-text">6. CheckPoint</span></a></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2017
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>




<script src="/js/app.js?rev=@@hash.js"></script>

</body>
</html>